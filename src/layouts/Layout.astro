---
import { Image } from "astro:assets";
import { identity, navBarLinks } from "../config";
import type { SEOInfo } from "../types/config";
import "../styles/globals.css";
import PageTransition from "../components/ui/page-transition";
import ThemeSwitch from "../components/ui/theme-switch";


interface Props {
	seo: SEOInfo;
}

const { seo } = Astro.props;
const pathname = Astro.url.pathname;
---

<script>
  const linkMenuButton = document.getElementById(
    "link-menu-button"
  ) as HTMLButtonElement;
  const linkMenu = document.getElementById("link-menu") as HTMLDivElement;
  const openIndicator = document.getElementById(
    "open-indicator"
  ) as HTMLSpanElement;

  linkMenuButton.addEventListener("click", () => {
    if (linkMenu.classList.contains("opacity-0")) {
      linkMenu.classList.remove("pointer-events-none");
      linkMenu.classList.remove("opacity-0");
      openIndicator.innerText = "-";
    } else {
      linkMenu.classList.add("pointer-events-none");
      linkMenu.classList.add("opacity-0");
      openIndicator.innerText = "+";
    }
  });

  document.addEventListener("click", (event) => {
    const isLinkMenuButtonClicked =
      event.target === linkMenuButton ||
      linkMenuButton.contains(event.target as Node);
    const isLinkMenuClicked =
      event.target === linkMenu || linkMenu.contains(event.target as Node);

    if (!isLinkMenuButtonClicked && !isLinkMenuClicked) {
      linkMenu.classList.add("pointer-events-none");
      linkMenu.classList.add("opacity-0");
      openIndicator.innerText = "+";
    }
  });
</script>

<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{seo.title}</title>
    <meta name="description" content={seo.description} />
    <meta property="og:title" content={seo.title} />
    <meta property="og:description" content={seo.description} />
    <meta property="og:image" content={seo.image} />
  </head>
  <body>
    <header class="fixed top-0 left-0 right-0 z-50 px-4 py-4">
      <div class="container max-w-6xl mx-auto">
        <div class="glass rounded-2xl px-6 py-4">
          <div class="flex items-center justify-between">
            <a href="/" class="flex items-center gap-2 group">
              <Image
                src={identity.logo}
                alt={"Logo"}
                width={50}
                height={50}
                class="w-[40px] h-[40px] object-cover transition-transform duration-300 group-hover:scale-110"
              />
              <span class="font-grotesk font-bold text-lg tracking-wider">
                {identity.name.split(' ')[0]}
              </span>
            </a>
            <nav class="ml-auto mr-6 sm:m-0">
              <ul class="hidden sm:flex sm:items-center sm:gap-2">
                {
                  navBarLinks.map((link) => (
                    <li>
                      <a
                        class={`group px-4 py-2 rounded-xl hover:bg-white/5 opacity-80 hover:opacity-100 transition-all duration-300 relative overflow-hidden ${pathname === link.url ? 'opacity-100 bg-white/5' : ''}`}
                        href={link.url}
                        target={link.external ? "_blank" : "_self"}
                      >
                        <span class="relative z-10">{link.title}</span>
                        <span class={`absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300 ${pathname === link.url ? 'w-full' : 'w-0 group-hover:w-full'}`}></span>
                      </a>
                    </li>
                  ))
                }
              </ul>
              <div class="relative sm:hidden">
                <button
                  id="link-menu-button"
                  class="relative font-medium opacity-80 hover:opacity-100 p-4 transition-opacity duration-300"
                  >Menu <span id="open-indicator">+</span></button
                >
                <div
                  id="link-menu"
                  class="absolute p-3 right-0 glass rounded-xl w-48 transition-all ease-in-out duration-300 opacity-0 pointer-events-none z-40"
                >
                  <ul class="space-y-1">
                    {
                      navBarLinks.map((link) => (
                        <li>
                          <a
                            class={`block px-4 py-3 hover:bg-white/5 rounded-lg transition-colors duration-200 ${pathname === link.url ? 'bg-white/5' : ''}`}
                            href={link.url}
                            target={link.external ? "_blank" : "_self"}
                          >
                            {link.title}
                          </a>
                        </li>
                      ))
                    }
                  </ul>
                </div>
              </div>
            </nav>
            <div class="flex items-center gap-3">
              <ThemeSwitch client:load />
              <a
                href=`mailto:${identity.email}`
                class="block p-2 opacity-60 hover:opacity-100 transition-all duration-300 hover:scale-110"
                aria-label="Email"
              >
                <!-- <IconWrapper name="mdi:email" width={20} height={20} /> -->
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <main class="pt-28 pb-32">
      <PageTransition client:load path={pathname}>
        <slot />
      </PageTransition>
    </main>
    
    <footer class="py-16 border-t border-white/10">
      <div class="container max-w-6xl mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
          <div class="flex items-center gap-3">
            <Image
              src={identity.logo}
              alt={"Logo"}
              width={40}
              height={40}
              class="w-[30px] h-[30px] object-cover"
            />
            <span class="font-grotesk font-medium">{identity.name}</span>
          </div>
          
          <div class="text-center md:text-right text-sm text-muted-foreground">
            <p>&copy; {new Date().getFullYear()} {identity.name}. All rights reserved.</p>
            <p class="mt-1">Built with Astro, Tailwind and ❤️</p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
